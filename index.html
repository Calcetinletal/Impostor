<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Impostor ‚Äî Sala + Ronda (link √∫nico)</title>
  <style>
    :root{
      --bg:#0b0f17; --card:#121a2a; --card2:#0b1220; --b:#223050;
      --txt:#e8eefc; --muted:#a9b7d6; --accent:#2e6bff; --accent2:#1b2740; --danger:#d84b4b;
      --ok:#2ecc71;
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:var(--txt)}
    .wrap{max-width:1040px;margin:0 auto;padding:18px}
    .card{background:var(--card);border:1px solid var(--b);border-radius:16px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{font-size:20px;margin:0 0 10px}
    .muted{color:var(--muted);font-size:14px;line-height:1.35}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;align-items:center}
    input, select{
      flex:1;min-width:170px;background:var(--card2);border:1px solid var(--b);color:var(--txt);
      border-radius:12px;padding:12px;font-size:16px
    }
    button{background:var(--accent);border:0;color:white;border-radius:12px;padding:12px 14px;font-size:16px;cursor:pointer}
    button.secondary{background:var(--accent2)}
    button.danger{background:var(--danger)}
    button.ok{background:var(--ok)}
    .hr{height:1px;background:var(--b);margin:14px 0}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:var(--accent2);border:1px solid var(--b);font-size:13px;color:#cfe0ff}
    .big{font-size:22px;font-weight:700;margin:10px 0}
    .twoCol{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:900px){ .twoCol{grid-template-columns:1.1fr .9fr} }
    .box{background:var(--card2);border:1px solid var(--b);border-radius:14px;padding:12px}
    .reveal{font-size:18px;line-height:1.4;white-space:pre-wrap;background:var(--card2);border:1px solid var(--b);border-radius:14px;padding:14px;margin-top:12px}
    .hint{font-size:12px;color:var(--muted);margin-top:6px}
    .warn{color:#ffd6a6}
    code{background:var(--card2);border:1px solid var(--b);border-radius:10px;padding:2px 6px}
    ul{margin:8px 0 0 18px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Impostor ‚Äî Sala + Ronda (sin reenviar links)</h1>
      <div class="muted">
        Enviad este link <b>una vez</b>. Luego, para cada ronda, el anfitri√≥n solo dice:
        <b>Sala</b> + <b>Ronda</b>. Cada m√≥vil calcula su carta.
      </div>

      <div class="twoCol">
        <!-- HOST -->
        <div class="box" id="hostBox">
          <div class="big" style="margin-top:0;">Anfitri√≥n</div>

          <div class="row">
            <input id="roomHost" placeholder="Sala (ej: FAMILIA2026)" />
            <input id="roundHost" type="number" min="1" value="1" />
          </div>

          <div class="row">
            <input id="playersHost" type="number" min="3" value="6" title="Jugadores" />
            <input id="impostorsHost" type="number" min="1" value="1" title="Impostores" />
          </div>

          <div class="row">
            <select id="topicModeHost">
              <option value="random">Tema aleatorio</option>
              <option value="choose">Elegir tema</option>
            </select>
            <select id="topicSelectHost" style="display:none;"></select>
          </div>

          <div class="row">
            <button id="hostCompute" class="ok">Actualizar ronda (mostrar tema)</button>
            <button id="hostNext">Siguiente ronda (+1)</button>
            <button id="hostReset" class="danger">Reset</button>
          </div>

          <div class="hint warn">
            El anfitri√≥n <b>no ver√° la palabra</b> (solo el tema). Para sincronizar, ense√±a/di el n√∫mero de ronda.
          </div>

          <div class="hr"></div>

          <div class="muted">Anuncio para decir en voz alta:</div>
          <div class="reveal" id="hostAnnounce">‚Äî</div>

          <div class="hr"></div>

          <div class="muted">Tema (solo para guiar la partida):</div>
          <div class="reveal" id="hostTheme">‚Äî</div>

          <div class="hint">
            Nota: sin servidor no se puede impedir que alguien cambie de ‚Äúslot‚Äù para curiosear.
          </div>
        </div>

        <!-- PLAYER -->
        <div class="box" id="playerBox">
          <div class="big" style="margin-top:0;">Jugador</div>

          <div class="row">
            <input id="roomPlayer" placeholder="Sala (igual que anfitri√≥n)" />
            <input id="roundPlayer" type="number" min="1" value="1" />
          </div>

          <div class="row">
            <input id="namePlayer" placeholder="Tu nombre (opcional)" />
            <input id="slotPlayer" type="number" min="1" value="1" title="Tu slot" />
          </div>

          <div class="row">
            <button id="playerSync" class="ok">Actualizar mi carta</button>
            <button id="playerHide" class="secondary" style="display:none;">Ocultar</button>
          </div>

          <div class="hint">
            Consejo: Elegid slots fijos (1..N) al inicio y no los cambi√©is.
          </div>

          <div class="hr"></div>

          <div class="row" style="justify-content:space-between">
            <span class="pill" id="pvTheme">Tema: ‚Äî</span>
            <span class="pill" id="pvMe">Slot: ‚Äî</span>
          </div>

          <div class="reveal" id="playerCard" style="display:none;">‚Äî</div>

          <div class="hr"></div>

          <div class="muted"><b>Reglas r√°pidas</b></div>
          <ul class="muted">
            <li>Normales: ven tema + palabra.</li>
            <li>Impostor(es): ven solo tema.</li>
            <li>1‚Äì2 vueltas de pistas, debate corto, votaci√≥n.</li>
          </ul>
        </div>
      </div>

      <div class="hr"></div>

      <div class="muted">
        <b>Personalizaci√≥n:</b> edita <code>DATA</code> m√°s abajo.
      </div>
    </div>
  </div>

<script>
/*** =========================
 *  TEMAS + LISTAS
 *  ========================= */
const DATA = {
  "Pa√≠ses": [
    "Espa√±a","Portugal","Francia","Italia","Alemania","Reino Unido","Irlanda","Grecia","Turqu√≠a","Marruecos",
    "Egipto","Israel","India","China","Jap√≥n","Corea del Sur","Australia","Estados Unidos","Canad√°","M√©xico"
  ],
  "Animales": [
    "Perro","Gato","Caballo","Vaca","Oveja","Cerdo","Conejo","Elefante","Tigre","Le√≥n",
    "Jirafa","Cebra","Oso panda","Koala","Lobo","Delf√≠n","Tibur√≥n","Ping√ºino","√Åguila","Serpiente"
  ],
  "Famosos (muy conocidos)": [
    "Lionel Messi","Cristiano Ronaldo","Arnold Schwarzenegger","Will Smith","Tom Cruise","Leonardo DiCaprio","Brad Pitt","Johnny Depp","Dwayne Johnson","Keanu Reeves",
    "Justin Bieber","Taylor Swift","Shakira","Beyonc√©","Rihanna","Adele","Ed Sheeran","Bad Bunny","Drake","Eminem",
    "Rafa Nadal","Carlos Alcaraz","Michael Jordan","LeBron James","Kim Kardashian","Elon Musk","Bill Gates","Mark Zuckerberg","Jeff Bezos","Oprah Winfrey"
  ],
  "Pol√≠ticos y l√≠deres (muy conocidos)": [
    "Donald Trump","Joe Biden","Barack Obama","Vladimir Putin","Xi Jinping","Volod√≠mir Zelenski","Nicol√°s Maduro","Javier Milei",
    "Pedro S√°nchez","Mariano Rajoy","Santiago Abascal","Arnaldo Otegi","Felipe VI","Juan Carlos I",
    "Emmanuel Macron","Giorgia Meloni","Ursula von der Leyen","Justin Trudeau","Angela Merkel"
  ],
  "Figuras hist√≥ricas (muy conocidas)": [
    "Albert Einstein","Napole√≥n Bonaparte","Wolfgang Amadeus Mozart","Miguel de Cervantes","Mahatma Gandhi",
    "Isaac Newton","Leonardo da Vinci","Julio C√©sar","Alejandro Magno","Cleopatra",
    "Crist√≥bal Col√≥n","Sim√≥n Bol√≠var","Martin Luther King Jr.","Nelson Mandela","Winston Churchill",
    "Adolf Hitler","Joseph Stalin","Beethoven","William Shakespeare","Marie Curie"
  ],
  "Profesiones": [
    "M√©dico","Enfermero","Profesor","Ingeniero","Arquitecto","Abogado","Juez","Polic√≠a","Bombero","Piloto",
    "Cocinero","Camarero","Mec√°nico","Electricista","Fontanero","Carpintero","Periodista","Fot√≥grafo","Veterinario","Programador"
  ],
  "Comidas y Bebidas": [
    "Paella","Tortilla de patatas","Gazpacho","Croquetas","Jam√≥n ib√©rico","Pizza","Hamburguesa","Sushi","Ramen","Tacos",
    "Burrito","Kebab","Pasta carbonara","Curry","Ceviche","Caf√©","T√©","Zumo de naranja","Cerveza","Vino"
  ],
  "Lugares comunes": [
    "Playa","Monta√±a","Parque","Bosque","R√≠o","Lago","Centro comercial","Supermercado","Aeropuerto","Estaci√≥n de tren",
    "Hospital","Colegio","Universidad","Biblioteca","Museo","Cine","Restaurante","Bar","Gimnasio","Hotel"
  ],
  "Edificios y monumentos (muy conocidos)": [
    "Torre Eiffel","Coliseo de Roma","Sagrada Familia","Alhambra","Big Ben","Taj Mahal","Estatua de la Libertad","Gran Muralla China","Pir√°mides de Giza","Machu Picchu",
    "√ìpera de S√≠dney","Burj Khalifa","Kremlin","Bas√≠lica de San Pedro","Notre Dame","Palacio de Versalles","Torre de Pisa","Puerta de Brandeburgo","Stonehenge","Mezquita-Catedral de C√≥rdoba"
  ],
  "Objetos comunes": [
    "M√≥vil","Cargador","Auriculares","Port√°til","Teclado","Rat√≥n","Televisor","Mando a distancia","Altavoz","Reloj",
    "Llaves","Cartera","Mochila","Botella de agua","Vaso","Taza","Plato","Cuchillo","Tenedor","Cuchara"
  ],
  "Conocidos (privado)": [
    "Loren","Aita","Ama","Nerea","Ainhoa","Javi","Juan","Isabel","Miguel","Nelson",
    "Ernesto","Ane","Judit","Amona","Amo√±i","Mamen","Fugas","Txiki","La atia"
  ]
};

/*** =========================
 *  RNG con semilla (determinista)
 *  ========================= */
// hash -> 128-bit seed (cyrb128) + PRNG (sfc32)
function cyrb128(str) {
  let h1 = 1779033703, h2 = 3144134277, h3 = 1013904242, h4 = 2773480762;
  for (let i = 0, k; i < str.length; i++) {
    k = str.charCodeAt(i);
    h1 = h2 ^ Math.imul(h1 ^ k, 597399067);
    h2 = h3 ^ Math.imul(h2 ^ k, 2869860233);
    h3 = h4 ^ Math.imul(h3 ^ k, 951274213);
    h4 = h1 ^ Math.imul(h4 ^ k, 2716044179);
  }
  h1 = Math.imul(h3 ^ (h1 >>> 18), 597399067);
  h2 = Math.imul(h4 ^ (h2 >>> 22), 2869860233);
  h3 = Math.imul(h1 ^ (h3 >>> 17), 951274213);
  h4 = Math.imul(h2 ^ (h4 >>> 19), 2716044179);
  return [(h1^h2^h3^h4)>>>0, (h2^h1)>>>0, (h3^h1)>>>0, (h4^h1)>>>0];
}
function sfc32(a, b, c, d) {
  return function() {
    a >>>= 0; b >>>= 0; c >>>= 0; d >>>= 0;
    let t = (a + b) | 0;
    a = b ^ (b >>> 9);
    b = (c + (c << 3)) | 0;
    c = (c << 21) | (c >>> 11);
    d = (d + 1) | 0;
    t = (t + d) | 0;
    c = (c + t) | 0;
    return (t >>> 0) / 4294967296;
  }
}
function makeRng(seedStr){
  const s = cyrb128(seedStr);
  return sfc32(s[0], s[1], s[2], s[3]);
}
function randInt(rng, n){ return Math.floor(rng()*n); }
function pick(rng, arr){ return arr[randInt(rng, arr.length)]; }

function clampImpostors(nPlayers, k){
  k = Math.max(1, Math.floor(k));
  return Math.min(k, nPlayers - 1);
}
function sampleImpostors(rng, nPlayers, k){
  const set = new Set();
  while(set.size < k){
    set.add(randInt(rng, nPlayers) + 1); // 1..n
  }
  return set;
}

/*** =========================
 *  UI init
 *  ========================= */
function keys(obj){ return Object.keys(obj); }

function fillTopicSelect(){
  const sel = document.getElementById("topicSelectHost");
  sel.innerHTML = "";
  keys(DATA).forEach(k=>{
    const opt = document.createElement("option");
    opt.value = k; opt.textContent = k;
    sel.appendChild(opt);
  });
}
fillTopicSelect();

document.getElementById("topicModeHost").addEventListener("change", (e)=>{
  document.getElementById("topicSelectHost").style.display = (e.target.value === "choose") ? "block" : "none";
});

/*** =========================
 *  Estado local (para no reescribir siempre)
 *  ========================= */
const LS = {
  room: "imp_room",
  roundH: "imp_round_host",
  playersH: "imp_players_host",
  impostorsH: "imp_impostors_host",
  topicModeH: "imp_topic_mode_host",
  topicSelH: "imp_topic_sel_host",
  roomP: "imp_room_player",
  roundP: "imp_round_player",
  slotP: "imp_slot_player",
  nameP: "imp_name_player"
};

function loadSaved(){
  const rh = localStorage.getItem(LS.room) || "";
  document.getElementById("roomHost").value = rh;
  document.getElementById("roomPlayer").value = localStorage.getItem(LS.roomP) || rh;

  document.getElementById("roundHost").value = localStorage.getItem(LS.roundH) || "1";
  document.getElementById("playersHost").value = localStorage.getItem(LS.playersH) || "6";
  document.getElementById("impostorsHost").value = localStorage.getItem(LS.impostorsH) || "1";
  document.getElementById("topicModeHost").value = localStorage.getItem(LS.topicModeH) || "random";
  document.getElementById("topicSelectHost").value = localStorage.getItem(LS.topicSelH) || keys(DATA)[0];

  document.getElementById("roundPlayer").value = localStorage.getItem(LS.roundP) || localStorage.getItem(LS.roundH) || "1";
  document.getElementById("slotPlayer").value = localStorage.getItem(LS.slotP) || "1";
  document.getElementById("namePlayer").value = localStorage.getItem(LS.nameP) || "";

  document.getElementById("topicSelectHost").style.display =
    (document.getElementById("topicModeHost").value === "choose") ? "block" : "none";
}
loadSaved();

function saveHost(){
  localStorage.setItem(LS.room, document.getElementById("roomHost").value.trim());
  localStorage.setItem(LS.roundH, String(document.getElementById("roundHost").value));
  localStorage.setItem(LS.playersH, String(document.getElementById("playersHost").value));
  localStorage.setItem(LS.impostorsH, String(document.getElementById("impostorsHost").value));
  localStorage.setItem(LS.topicModeH, document.getElementById("topicModeHost").value);
  localStorage.setItem(LS.topicSelH, document.getElementById("topicSelectHost").value);

  // Por comodidad, empuja sala al jugador en ESTE dispositivo
  localStorage.setItem(LS.roomP, document.getElementById("roomHost").value.trim());
  localStorage.setItem(LS.roundP, String(document.getElementById("roundHost").value));
}
function savePlayer(){
  localStorage.setItem(LS.roomP, document.getElementById("roomPlayer").value.trim());
  localStorage.setItem(LS.roundP, String(document.getElementById("roundPlayer").value));
  localStorage.setItem(LS.slotP, String(document.getElementById("slotPlayer").value));
  localStorage.setItem(LS.nameP, document.getElementById("namePlayer").value.trim());
}

/*** =========================
 *  Motor de ronda
 *  ========================= */
function computeRound(params){
  const { room, round, nPlayers, kImpostors, topicMode, chosenTopic } = params;

  const seedBase = `ROOM=${room}|ROUND=${round}|N=${nPlayers}|K=${kImpostors}|MODE=${topicMode}|TOPIC=${chosenTopic||""}`;
  const rng = makeRng(seedBase);

  const topics = keys(DATA);
  const topic = (topicMode === "choose" && chosenTopic) ? chosenTopic : topics[randInt(rng, topics.length)];
  const word = pick(rng, DATA[topic]);

  const impostors = sampleImpostors(rng, nPlayers, kImpostors);

  return { topic, word, impostors };
}

/*** =========================
 *  HOST actions
 *  ========================= */
function hostUpdate(showIncrement=false){
  const room = document.getElementById("roomHost").value.trim();
  const round = Math.max(1, parseInt(document.getElementById("roundHost").value || "1", 10));
  const nPlayers = Math.max(3, parseInt(document.getElementById("playersHost").value || "6", 10));
  let k = parseInt(document.getElementById("impostorsHost").value || "1", 10);
  k = clampImpostors(nPlayers, k);
  document.getElementById("impostorsHost").value = String(k);

  const topicMode = document.getElementById("topicModeHost").value;
  const chosenTopic = document.getElementById("topicSelectHost").value;

  if(!room){
    document.getElementById("hostAnnounce").textContent = "Pon una Sala (ej: FAMILIA2026).";
    document.getElementById("hostTheme").textContent = "‚Äî";
    return;
  }

  const out = computeRound({ room, round, nPlayers, kImpostors: k, topicMode, chosenTopic });

  // Host NO ve palabra: solo tema y anuncio
  document.getElementById("hostAnnounce").textContent =
    `Sala: ${room}\nRonda: ${round}\nJugadores: ${nPlayers}\nImpostores: ${k}\n\n(Di/ense√±a ‚ÄúSala ${room}, ronda ${round}‚Äù)`;

  document.getElementById("hostTheme").textContent = `Tema: ${out.topic}\n\n(La palabra NO se muestra al anfitri√≥n)`;

  saveHost();
}

document.getElementById("hostCompute").addEventListener("click", ()=>hostUpdate());
document.getElementById("hostNext").addEventListener("click", ()=>{
  const r = Math.max(1, parseInt(document.getElementById("roundHost").value || "1", 10)) + 1;
  document.getElementById("roundHost").value = String(r);
  hostUpdate();
});
document.getElementById("hostReset").addEventListener("click", ()=>{
  document.getElementById("roundHost").value = "1";
  hostUpdate();
});

/*** =========================
 *  PLAYER actions
 *  ========================= */
function playerUpdate(){
  const room = document.getElementById("roomPlayer").value.trim();
  const round = Math.max(1, parseInt(document.getElementById("roundPlayer").value || "1", 10));
  const slot = Math.max(1, parseInt(document.getElementById("slotPlayer").value || "1", 10));
  const name = document.getElementById("namePlayer").value.trim();

  // Los par√°metros de la sala (N, K, topicMode, topicSel) deben coincidir con el anfitri√≥n
  // Para simplificar: el jugador los ‚Äútoma‚Äù de lo guardado por el anfitri√≥n SOLO si existe en su dispositivo.
  // En dispositivos distintos: el anfitri√≥n lo dice una vez al inicio (N y K) y se fija.
  const nPlayers = Math.max(3, parseInt(localStorage.getItem(LS.playersH) || "6", 10));
  const k = clampImpostors(nPlayers, parseInt(localStorage.getItem(LS.impostorsH) || "1", 10));
  const topicMode = localStorage.getItem(LS.topicModeH) || "random";
  const chosenTopic = localStorage.getItem(LS.topicSelH) || keys(DATA)[0];

  if(!room){
    alert("Escribe la Sala (igual que la del anfitri√≥n).");
    return;
  }

  const out = computeRound({ room, round, nPlayers, kImpostors: k, topicMode, chosenTopic });

  const isImp = out.impostors.has(slot);

  document.getElementById("pvTheme").textContent = `Tema: ${out.topic}`;
  document.getElementById("pvMe").textContent = name ? `Slot ${slot} (${name})` : `Slot ${slot}`;

  const card = document.getElementById("playerCard");
  card.style.display = "block";
  card.textContent = isImp
    ? `Eres el IMPOSTOR üòà\nTema: ${out.topic}\nPalabra: (no la sabes)`
    : `No eres impostor ‚úÖ\nTema: ${out.topic}\nPalabra: ${out.word}`;

  document.getElementById("playerHide").style.display = "inline-block";
  savePlayer();
}

document.getElementById("playerSync").addEventListener("click", playerUpdate);
document.getElementById("playerHide").addEventListener("click", ()=>{
  document.getElementById("playerCard").style.display = "none";
  document.getElementById("playerHide").style.display = "none";
});

// Primer render host
hostUpdate();
</script>
</body>
</html>
