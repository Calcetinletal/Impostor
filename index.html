<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Impostor ‚Äî Links por ronda</title>
  <style>
    :root{
      --bg:#0b0f17; --card:#121a2a; --card2:#0b1220; --b:#223050;
      --txt:#e8eefc; --muted:#a9b7d6; --accent:#2e6bff; --accent2:#1b2740; --danger:#d84b4b;
      --ok:#2ecc71;
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:var(--txt)}
    .wrap{max-width:1040px;margin:0 auto;padding:18px}
    .card{background:var(--card);border:1px solid var(--b);border-radius:16px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{font-size:20px;margin:0 0 10px}
    .muted{color:var(--muted);font-size:14px;line-height:1.35}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;align-items:center}
    input, select{
      flex:1;min-width:170px;background:var(--card2);border:1px solid var(--b);color:var(--txt);
      border-radius:12px;padding:12px;font-size:16px
    }
    button{background:var(--accent);border:0;color:white;border-radius:12px;padding:12px 14px;font-size:16px;cursor:pointer}
    button.secondary{background:var(--accent2)}
    button.danger{background:var(--danger)}
    button.ok{background:var(--ok)}
    .hr{height:1px;background:var(--b);margin:14px 0}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:var(--accent2);border:1px solid var(--b);font-size:13px;color:#cfe0ff}
    .links{margin-top:12px}
    .linkrow{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;
      margin:10px 0;padding:10px;background:var(--card2);border:1px solid var(--b);border-radius:14px
    }
    .linkrow .left{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .linkrow b{min-width:92px}
    .linkrow a{color:#9fc1ff;word-break:break-all}
    .reveal{font-size:18px;line-height:1.4;white-space:pre-wrap;background:var(--card2);border:1px solid var(--b);border-radius:14px;padding:14px;margin-top:12px}
    .big{font-size:22px;font-weight:700;margin:10px 0}
    .twoCol{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:900px){ .twoCol{grid-template-columns:1.15fr .85fr} }
    .box{background:var(--card2);border:1px solid var(--b);border-radius:14px;padding:12px}
    ul{margin:8px 0 0 18px}
    .hint{font-size:12px;color:var(--muted);margin-top:6px}
    .warn{color:#ffd6a6}
    code{background:var(--card2);border:1px solid var(--b);border-radius:10px;padding:2px 6px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Impostor ‚Äî links por ronda (sin PIN)</h1>

      <!-- HOST VIEW -->
      <div id="hostView">
        <div class="twoCol">
          <div class="box">
            <div class="muted">
              Genera una ronda y pega los <b>links</b> en el grupo. Cada uno abre su slot y pulsa <b>Revelar</b>.
              <br><span class="warn">Sin PIN no hay forma de impedir que abran otros links (si quieren).</span>
            </div>

            <div class="row">
              <input id="players" type="number" min="3" value="6" title="N√∫mero de jugadores" />
              <input id="impostors" type="number" min="1" value="1" title="N√∫mero de impostores" />
              <select id="topicMode" title="Tema">
                <option value="random">Tema aleatorio</option>
                <option value="choose">Elegir tema</option>
              </select>
              <select id="topicSelect" style="display:none;"></select>
            </div>

            <div class="hint">
              Recomendaci√≥n: 1 impostor hasta 6‚Äì7 jugadores; 2 a partir de 8‚Äì10.
            </div>

            <div class="row">
              <button id="newRound" class="ok">Generar ronda</button>
              <button id="copyAll" class="secondary" style="display:none;">Copiar links</button>
              <button id="reset" class="danger">Reset</button>
            </div>

            <div class="hr"></div>

            <div id="summary" class="muted">A√∫n no hay ronda.</div>
            <div id="links" class="links" style="display:none;"></div>

            <div class="hr"></div>
            <div class="muted">
              <b>Personalizaci√≥n:</b> edita el objeto <code>DATA</code> dentro de este archivo.
            </div>
          </div>

          <div class="box">
            <div class="big" style="margin-top:0">Reglas r√°pidas</div>
            <ul class="muted">
              <li><b>Normales</b>: ven tema + palabra.</li>
              <li><b>Impostor(es)</b>: ven solo tema.</li>
              <li>1‚Äì2 vueltas: cada uno da una pista (sin decir la palabra).</li>
              <li>Debate corto y votaci√≥n.</li>
              <li>(Opcional) si pillan al impostor, puede intentar adivinar la palabra.</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- PLAYER VIEW -->
      <div id="playerView" style="display:none;">
        <div class="muted">
          Est√°s viendo tu carta. Pulsa <b>Revelar</b> cuando est√©s a solas.
        </div>

        <div class="row" style="justify-content:space-between">
          <span class="pill" id="pvTheme"></span>
          <span class="pill" id="pvWho"></span>
        </div>

        <div class="big" id="pvTitle">Tu rol</div>

        <div class="row">
          <button id="pvRevealBtn" class="ok">Revelar</button>
          <button id="pvHideBtn" class="secondary" style="display:none;">Ocultar</button>
        </div>

        <div id="pvBox" class="reveal" style="display:none;"></div>

        <div class="row">
          <button id="backToHost" class="secondary">Volver</button>
        </div>
      </div>
    </div>
  </div>

<script>
/*** =========================
 *  LISTAS (DATA)
 *  ========================= */
const DATA = {
  "Pa√≠ses": ["Espa√±a","Portugal","Francia","Italia","Alemania","Reino Unido","Irlanda","Grecia","Turqu√≠a","Marruecos","Egipto","Israel","India","China","Jap√≥n","Corea del Sur","Australia","Estados Unidos","Canad√°","M√©xico"],
  "Animales": ["Perro","Gato","Caballo","Vaca","Oveja","Cerdo","Conejo","Elefante","Tigre","Le√≥n","Jirafa","Cebra","Oso panda","Koala","Lobo","Delf√≠n","Tibur√≥n","Ping√ºino","√Åguila","Serpiente"],
  "Famosos (muy conocidos)": ["Lionel Messi","Cristiano Ronaldo","Arnold Schwarzenegger","Will Smith","Tom Cruise","Leonardo DiCaprio","Brad Pitt","Johnny Depp","Dwayne Johnson","Keanu Reeves","Justin Bieber","Taylor Swift","Shakira","Beyonc√©","Rihanna","Adele","Ed Sheeran","Bad Bunny","Drake","Eminem","Rafa Nadal","Carlos Alcaraz","Michael Jordan","LeBron James","Kim Kardashian","Elon Musk","Bill Gates","Mark Zuckerberg","Jeff Bezos","Oprah Winfrey"],
  "Pol√≠ticos y l√≠deres (muy conocidos)": ["Donald Trump","Joe Biden","Barack Obama","Vladimir Putin","Xi Jinping","Volod√≠mir Zelenski","Nicol√°s Maduro","Javier Milei","Pedro S√°nchez","Mariano Rajoy","Santiago Abascal","Arnaldo Otegi","Felipe VI","Juan Carlos I","Emmanuel Macron","Giorgia Meloni","Ursula von der Leyen","Justin Trudeau","Angela Merkel"],
  "Peliculas o series": ["El Padrino","Star Wars","Jurassic Park","El se√±or de los anillos","Harry Potter","Los Vengadores","Titanic","Breaking Bad","24","Forrest Gump","El bueno, el feo y el malo","Matrix","Tibur√≥n","E.T. El extraterrestre","Gladiator","Giorgia Meloni","Indiana Jones","Solo en casa","One Piece","Dragon Ball","Pokemon","Lo que el viento se llevo", "Los Simpsons"],
  "Figuras hist√≥ricas (muy conocidos)": ["Albert Einstein","Napole√≥n Bonaparte","Wolfgang Amadeus Mozart","Miguel de Cervantes","Mahatma Gandhi","Isaac Newton","Leonardo da Vinci","Julio C√©sar","Alejandro Magno","Cleopatra","Crist√≥bal Col√≥n","Sim√≥n Bol√≠var","Martin Luther King Jr.","Nelson Mandela","Winston Churchill","Adolf Hitler","Joseph Stalin","Beethoven","William Shakespeare","Marie Curie"],
  "Profesiones": ["M√©dico","Enfermero","Profesor","Ingeniero","Arquitecto","Abogado","Juez","Polic√≠a","Bombero","Piloto","Cocinero","Camarero","Mec√°nico","Electricista","Fontanero","Carpintero","Periodista","Fot√≥grafo","Veterinario","Programador"],
  "Comidas y Bebidas": ["Paella","Tortilla de patatas","Gazpacho","Croquetas","Jam√≥n ib√©rico","Pizza","Hamburguesa","Sushi","Ramen","Tacos","Burrito","Kebab","Pasta carbonara","Curry","Ceviche","Caf√©","T√©","Zumo de naranja","Cerveza","Vino"],
  "Lugares comunes": ["Playa","Monta√±a","Parque","Bosque","R√≠o","Lago","Centro comercial","Supermercado","Aeropuerto","Estaci√≥n de tren","Hospital","Colegio","Universidad","Biblioteca","Museo","Cine","Restaurante","Bar","Gimnasio","Hotel"],
  "Edificios y monumentos (muy conocidos)": ["Torre Eiffel","Coliseo de Roma","Sagrada Familia","Alhambra","Big Ben","Taj Mahal","Estatua de la Libertad","Gran Muralla China","Pir√°mides de Giza","Machu Picchu","√ìpera de S√≠dney","Burj Khalifa","Kremlin","Bas√≠lica de San Pedro","Notre Dame","Palacio de Versalles","Torre de Pisa","Puerta de Brandeburgo","Stonehenge","Mezquita-Catedral de C√≥rdoba"],
  "Objetos comunes": ["M√≥vil","Cargador","Auriculares","Port√°til","Teclado","Rat√≥n","Televisor","Mando a distancia","Altavoz","Reloj","Llaves","Cartera","Mochila","Botella de agua","Vaso","Taza","Plato","Cuchillo","Tenedor","Cuchara"],
  "Conocidos (privado)": ["Loren-hijo","Aita","Ama","Nerea","Ainhoa","Javi","Juan","Isabel","Jose Mari","Mirentxu","Miguel-hijo","Nelson","Ernesto","Ane","Judit","Amona","Amo√±i","Mamen","Fugas","Txiki","La atia","Cotorra asesina","Andoni","I√±aki","Manu","Bakartxo","Ignacio","Fernando-padre",""],
  "Objetos conocidos (privado)": ["Nueces del aita","Camisetas de vagabundo de la ama","Mayonesa de Nerea","Cremitas de Lorange","Monta√±a de ropa de Ainhoa","Marihuana de Javi","Cuadro de Juan","U√±as de Miguel","Mierda de Fugas/Txiki de la terraza","Especias caducadas de 1970 del frigor√≠fico","Furgoneta del aita","Cerezas de Juan","Perchas de Isabel","Master de Ane"]
};

/*** =========================
 *  HELPERS
 *  ========================= */
function randInt(n){ return Math.floor(Math.random()*n); }
function pick(arr){ return arr[randInt(arr.length)]; }
function keys(obj){ return Object.keys(obj); }

// Base64 URL-safe
function b64e(str){
  return btoa(unescape(encodeURIComponent(str))).replaceAll("=","").replaceAll("+","-").replaceAll("/","_");
}
function b64d(str){
  str = str.replaceAll("-","+").replaceAll("_","/");
  const pad = str.length % 4; if(pad) str += "=".repeat(4-pad);
  return decodeURIComponent(escape(atob(str)));
}

function makePayload(obj){
  obj._ = Math.random().toString(16).slice(2,10); // salt
  return b64e(JSON.stringify(obj));
}
function readPayload(){
  const h = location.hash || "";
  if(!h.startsWith("#p=")) return null;
  try{ return JSON.parse(b64d(h.slice(3))); } catch(e){ return null; }
}

function clampImpostors(nPlayers, k){
  k = Math.max(1, Math.floor(k));
  return Math.min(k, nPlayers - 1);
}
function sampleUniquePlayers(nPlayers, k){
  const chosen = new Set();
  while(chosen.size < k) chosen.add(randInt(nPlayers) + 1);
  return chosen;
}

/*** =========================
 *  UI init
 *  ========================= */
function fillTopicSelect(){
  const sel = document.getElementById("topicSelect");
  sel.innerHTML = "";
  keys(DATA).forEach(k=>{
    const opt = document.createElement("option");
    opt.value = k; opt.textContent = k;
    sel.appendChild(opt);
  });
}
fillTopicSelect();

document.getElementById("topicMode").addEventListener("change", (e)=>{
  const show = e.target.value === "choose";
  document.getElementById("topicSelect").style.display = show ? "block" : "none";
});

/*** =========================
 *  HOST generate
 *  ========================= */
function hostGenerate(){
  const n = Math.max(3, parseInt(document.getElementById("players").value || "6", 10));
  let k = parseInt(document.getElementById("impostors").value || "1", 10);
  k = clampImpostors(n, k);
  document.getElementById("impostors").value = String(k);

  const mode = document.getElementById("topicMode").value;
  const topic = mode === "choose" ? document.getElementById("topicSelect").value : pick(keys(DATA));
  const word = pick(DATA[topic]);

  const impostorSet = sampleUniquePlayers(n, k);
  const baseUrl = location.href.split("#")[0].split("?")[0];

  const links = [];
  for(let i=1;i<=n;i++){
    const isImp = impostorSet.has(i);
    const payload = makePayload({
      v: 1,
      role: isImp ? "IMPOSTOR" : "NORMAL",
      slot: i,
      topic,
      word: isImp ? null : word
    });
    links.push({ slot:i, url: `${baseUrl}#p=${payload}` });
  }

  document.getElementById("summary").innerHTML =
    `Ronda lista. Tema: <b>${topic}</b>. Impostores: <b>${k}</b>.`;

  const box = document.getElementById("links");
  box.style.display = "block";
  box.innerHTML = links.map(x => `
    <div class="linkrow">
      <div class="left">
        <b>Slot ${x.slot}</b>
        <a href="${x.url}">${x.url}</a>
      </div>
      <div class="left">
        <button class="secondary" data-copy="${x.url}">Copiar</button>
      </div>
    </div>
  `).join("");

  box.querySelectorAll("button[data-copy]").forEach(btn=>{
    btn.addEventListener("click", async ()=>{
      const u = btn.getAttribute("data-copy");
      try{
        await navigator.clipboard.writeText(u);
        btn.textContent="¬°Copiado!";
        setTimeout(()=>btn.textContent="Copiar", 900);
      }catch(e){
        alert("No pude copiar autom√°ticamente. Mant√©n pulsado el enlace y c√≥pialo manualmente.");
      }
    });
  });

  const copyAllBtn = document.getElementById("copyAll");
  copyAllBtn.style.display = "inline-block";
  copyAllBtn.onclick = async ()=>{
    const text = links.map(x => `Slot ${x.slot}: ${x.url}`).join("\n");
    try{
      await navigator.clipboard.writeText(text);
      alert("Copiado. P√©galo en el grupo.");
    }catch(e){
      alert("No pude copiar. Copia manualmente desde la lista.");
    }
  };
}

function hostReset(){
  location.hash = "";
  document.getElementById("summary").textContent = "A√∫n no hay ronda.";
  const box = document.getElementById("links");
  box.style.display = "none";
  box.innerHTML = "";
  document.getElementById("copyAll").style.display = "none";
}

/*** =========================
 *  PLAYER view
 *  ========================= */
function showPlayer(payload){
  document.getElementById("hostView").style.display = "none";
  document.getElementById("playerView").style.display = "block";

  const theme = payload.topic || "Tema";
  document.getElementById("pvTheme").textContent = `Tema: ${theme}`;

  const slot = payload.slot ?? "?";
  document.getElementById("pvWho").textContent = `Slot ${slot}`;

  const isImp = payload.role === "IMPOSTOR";
  document.getElementById("pvTitle").textContent = isImp ? "Impostor" : "Jugador normal";

  const text = isImp
    ? `Eres el IMPOSTOR üòà\nTema: ${theme}\nPalabra: (no la sabes)`
    : `No eres impostor ‚úÖ\nTema: ${theme}\nPalabra: ${payload.word}`;

  const box = document.getElementById("pvBox");
  const rev = document.getElementById("pvRevealBtn");
  const hid = document.getElementById("pvHideBtn");

  rev.onclick = ()=>{
    box.textContent = text;
    box.style.display = "block";
    rev.style.display = "none";
    hid.style.display = "inline-block";
  };
  hid.onclick = ()=>{
    box.style.display = "none";
    box.textContent = "";
    rev.style.display = "inline-block";
    hid.style.display = "none";
  };
}

document.getElementById("newRound").addEventListener("click", hostGenerate);
document.getElementById("reset").addEventListener("click", hostReset);
document.getElementById("backToHost").addEventListener("click", ()=>{
  location.hash = "";
  document.getElementById("playerView").style.display = "none";
  document.getElementById("hostView").style.display = "block";
});

// Auto route
const payload = readPayload();
if(payload){
  showPlayer(payload);
}
</script>
</body>
</html>
